% at least enough for building bootstrap packages

readonly TARGET = "FreeBSD4"
readonly WORD_SIZE = "32BITS"

readonly m3back_flags = "-gstabs+ -quiet -m32 -fPIC"
readonly SYSTEM_CC = "gcc -gstabs+ -m32 -fPIC"
readonly SYSTEM_ASM = "as -32"

%
% newer platforms never needed these workarounds for
% bootstrapping with older builds
%
readonly proc GetGcWrapFlags() is return "" end
readonly proc FixM3GcDefs(x) is return x end
readonly proc GetM3BackFlag(x) is return x end

GNU_MAKE = "gmake"

include("Unix.common")

SYSTEM_LIBS{"ODBC"} = [ "-Wl,-R/usr/local/lib", "-L/usr/local/lib", "-lodbc" ]
SYSTEM_LIBS{"POSTGRES95"} = [ "-Wl,-R/usr/local/lib", "-L/usr/local/lib", "-lpq" ]

SYSTEM_LD = SYSTEM_CC
  & " -z now"
  & " -Bsymbolic"
% I thought -as-needed was generally considered good, but it is
% breaking Linux/x86 so disable here for now.
% & " -Wl,--as-needed"
  & " -Wl,--fatal-warnings"
% & " -Wl,-no-allow-shlib-undefined"
  & " -Wl,--warn-common"

if defined("M3_USE_OVERRIDES")
  if M3_USE_OVERRIDES
    M3_SHARED_LIB_ARG = "-Wl,-rpath,"
  else
    M3_SHARED_LIB_ARG = ""
    SYSTEM_LD = SYSTEM_LD
      & " -z origin"
      & " -Wl,-rpath,\\$ORIGIN/../lib" % installroot/bin to installroot/lib
    if equal($M3_PORTABLE_RUN_PATH, "")
      SYSTEM_LD = SYSTEM_LD
        & " -Wl,-rpath," & INSTALL_ROOT & "/lib" % non-portable
    end
  end
else
  M3_SHARED_LIB_ARG = "-Wl,-rpath,"
end
