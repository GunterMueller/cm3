<HTML>
<HEAD>
<TITLE>Critical Mass Modula-3: m3core/src/thread/PTHREAD/ThreadPThread.i3</TITLE>
</HEAD>
<BODY bgcolor="#ffffff">
<A NAME="0TOP0">
<H2>m3core/src/thread/PTHREAD/ThreadPThread.i3</H2></A><HR>
<inInterface>
<PRE></PRE> Copyright (C) 2005, Purdue Research Foundation                  
 All rights reserved.                                            
 See the file COPYRIGHT-PURDUE for a full description.           

<P>---------------------------------------------------------------------------

<P><PRE>UNSAFE INTERFACE <interface><A HREF="ThreadPThread.m3.html">ThreadPThread</A></interface>;

FROM <A HREF="../../C/Common/Ctypes.i3.html">Ctypes</A> IMPORT int;
FROM <A HREF="../../C/Common/Cstddef.i3.html">Cstddef</A> IMPORT size_t;
FROM <A HREF="#x1">Upthread</A> IMPORT pthread_t, start_routine_t;
</PRE>---------------------------------------------------------------------------

<P><PRE>PROCEDURE <A HREF="ThreadPThread.m3.html#SignalHandler">SignalHandler</A>(sig: int; sip, uap: ADDRESS);
</PRE>---------------------------------------------------------------------------

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__SIG_SUSPEND&quot;*&gt;
</PRE><BLOCKQUOTE><EM>CONST</EM></BLOCKQUOTE><PRE> VAR SIG_SUSPEND: int;
</PRE>---------------------------------------------------------------------------

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__SetupHandlers&quot;*&gt;
PROCEDURE SetupHandlers();
</PRE>---------------------------------------------------------------------------

<P> the semaphore is implied 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__sem_wait&quot;*&gt;
PROCEDURE sem_wait (): int;
&lt;*EXTERNAL &quot;ThreadPThread__sem_post&quot;*&gt;
PROCEDURE sem_post (): int;

&lt;*EXTERNAL &quot;ThreadPThread__sem_getvalue&quot;*&gt;
PROCEDURE sem_getvalue (VAR value: int): int;
</PRE>---------------------------------------------------------------------------

<P> the signal set is implied 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__sigsuspend&quot;*&gt;
PROCEDURE sigsuspend (): int;
</PRE>---------------------------------------------------------------------------

<P> pthread_create but replace attr with stackSize so that attr need not be known to Modula-3 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__thread_create&quot;*&gt;
PROCEDURE thread_create(VAR pthread: pthread_t; stackSize: size_t;
                        start_routine: start_routine_t; arg: ADDRESS): int;
</PRE>---------------------------------------------------------------------------

<P> implement the statically allocated mutexes, condition variables, and
thread locals. These are wrappers to:
 pthread_mutex_lock
 pthread_mutex_unlock
 pthread_cond_broadcast
 pthread_cond_wait
 pthread_key_create
 pthread_setspecific
 pthread_getspecific
 <P>
where the parameters are all implied, and are indicated
by the last part of the function name.
This reduces platform specific code as it removes
the need for the Modula-3 code to define the static mutexes and condition variable(s).


<P> mutex <CODE>active</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_lock_active&quot;*&gt;
PROCEDURE pthread_mutex_lock_active():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_unlock_active&quot;*&gt;
PROCEDURE pthread_mutex_unlock_active():int;
</PRE> mutex <CODE>slot</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_lock_slot&quot;*&gt;
PROCEDURE pthread_mutex_lock_slot():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_unlock_slot&quot;*&gt;
PROCEDURE pthread_mutex_unlock_slot():int;
</PRE> mutex <CODE>init</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_lock_init&quot;*&gt;
PROCEDURE pthread_mutex_lock_init():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_unlock_init&quot;*&gt;
PROCEDURE pthread_mutex_unlock_init():int;
</PRE> mutex <CODE>perf</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_lock_perf&quot;*&gt;
PROCEDURE pthread_mutex_lock_perf():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_unlock_perf&quot;*&gt;
PROCEDURE pthread_mutex_unlock_perf():int;
</PRE> mutex <CODE>heap</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_lock_heap&quot;*&gt;
PROCEDURE pthread_mutex_lock_heap():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_unlock_heap&quot;*&gt;
PROCEDURE pthread_mutex_unlock_heap():int;
</PRE> condition variable <CODE>heap</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_cond_broadcast_heap&quot;*&gt;
PROCEDURE pthread_cond_broadcast_heap():int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_cond_wait_heap&quot;*&gt;
PROCEDURE pthread_cond_wait_heap():int;
</PRE> thread local <CODE>activation</CODE> 

<P><PRE>&lt;*EXTERNAL &quot;ThreadPThread__pthread_key_create_activations&quot;*&gt;
PROCEDURE pthread_key_create_activations(): int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_setspecific_activations&quot;*&gt;
PROCEDURE pthread_setspecific_activations(value: ADDRESS): int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_getspecific_activations&quot;*&gt;
PROCEDURE pthread_getspecific_activations(): ADDRESS;
</PRE>---------------------------------------------------------------------------

<P> support for dynamically allocated mutexes and condition variables 

<P><PRE>TYPE
    pthread_mutex_t = ADDRESS;
    pthread_cond_t = ADDRESS;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_new&quot;*&gt;
PROCEDURE pthread_mutex_new():pthread_mutex_t;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_mutex_delete&quot;*&gt;
PROCEDURE pthread_mutex_delete(a:pthread_mutex_t);

&lt;*EXTERNAL*&gt;
PROCEDURE pthread_mutex_lock(mutex: pthread_mutex_t):int;

&lt;*EXTERNAL*&gt;
PROCEDURE pthread_mutex_unlock(mutex: pthread_mutex_t):int;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_cond_new&quot;*&gt;
PROCEDURE pthread_cond_new():pthread_mutex_t;

&lt;*EXTERNAL &quot;ThreadPThread__pthread_cond_delete&quot;*&gt;
PROCEDURE pthread_cond_delete(a:pthread_cond_t);

&lt;*EXTERNAL*&gt;
PROCEDURE pthread_cond_wait(cond: pthread_cond_t; mutex: pthread_mutex_t):int;

&lt;*EXTERNAL*&gt;
PROCEDURE pthread_cond_signal(cond: pthread_cond_t):int;
</PRE>---------------------------------------------------------------------------

<P><PRE>END ThreadPThread.
</PRE>
</inInterface>
<HR>
<A NAME="x1">interface Upthread is in:
</A><UL>
<LI><A HREF="../../unix/Common/Upthread.i3.html#0TOP0">m3core/src/unix/Common/Upthread.i3</A>
<LI><A HREF="../../unix/linux-common/Upthread.i3.html#0TOP0">m3core/src/unix/linux-common/Upthread.i3</A>
</UL>
<P>
<PRE>























</PRE>
</BODY>
</HTML>
